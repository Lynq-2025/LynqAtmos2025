# ğŸš€ Green Signal Advanced Challenge - START HERE\n\n## âœ… Verification: All Files Ready\n\nâœ… `data/emails.json` - 20 emails ready for analysis\nâœ… `workflows/green-signal_advanced_agentic.json` - Advanced agentic workflow\nâœ… `main_advanced.py` - Backend with tool APIs\n\n---\n\n## ğŸ¯ 4-Step Solution Process\n\n### STEP 1: Start the Backend Server (Terminal 1)\n\n```bash\ncd /Users/shaynavinoth/Downloads/Green\\ Signal\\ 2\npython3 -m uvicorn main_advanced:app --host 0.0.0.0 --port 3000 --reload\n```\n\n**You should see:**\n```\nINFO:     Uvicorn running on http://0.0.0.0:3000\nINFO:     Application startup complete\n```\n\n**Verify it works:**\n```bash\n# Open Terminal 2\ncurl http://localhost:3000/health\n```\n\nShould return: `{\"status\": \"online\", ...}`\n\n---\n\n### STEP 2: Import Workflow into n8n\n\n**Requirement**: n8n must be running on http://localhost:5678\n\n1. **Open n8n** â†’ http://localhost:5678\n2. Click **\"New\"** (top left)\n3. Select **\"Create blank workflow\"**\n4. Click **\"...\"** (three dots) â†’ **\"Import from file\"**\n5. Navigate to and select: `workflows/green-signal_advanced_agentic.json`\n6. Click **\"Open\"**\n\n**Result**: You should see 21 nodes arranged in a workflow\n\n---\n\n### STEP 3: Configure OpenAI Credentials\n\n**Get your API key:**\n1. Go to: https://platform.openai.com/api-keys\n2. Create or copy your API key\n3. Keep it handy\n\n**Configure in n8n:**\n\n1. Find the first orange LLM node: **\"Agent: Plan Analysis (Tool Use)\"**\n2. Double-click to open it\n3. Look for **\"Model\"** field dropdown\n4. Click the **credential selector** (key icon)\n5. Click **\"Create New\"** â†’ **\"OpenAI\"**\n6. Paste your API key\n7. Click **\"Save\"**\n\n**Repeat for 2 more LLM nodes:**\n- **\"Agent: Multi-Factor Analysis\"** (middle workflow)\n- **\"Agent: Skeptical Review (Low Confidence)\"** (lower right)\n\n**Select Model:**\n- Choose: **gpt-4-turbo** (recommended)\n- Or: **gpt-4** if available\n- Avoid: gpt-3.5-turbo (less reliable for reasoning)\n\n---\n\n### STEP 4: Execute the Workflow\n\n1. **Save the workflow**: Ctrl+S (or Cmd+S)\n2. **Click** the **\"Start Advanced Agent\"** node (top left, blue trigger)\n3. Click the blue **\"Execute\"** button\n4. **Wait** for execution (2-5 minutes for 20 emails)\n\n**Watch the progress:**\n- Green checkmarks = nodes completing successfully\n- Orange nodes = currently executing\n- Red = errors (troubleshoot below)\n\n**Final step**: Click the **\"Display: Results & Score\"** node to see:\n```json\n{\n  \"success\": true,\n  \"score\": 1000,\n  \"accuracy\": 0.95,\n  \"flag\": \"FLAG{green_signal_advanced_mastered}\",\n  \"message\": \"âœ… PERFECT - Detected 19/20 phishing emails (95% accuracy)\"\n}\n```\n\n---\n\n## ğŸ” What the Agent Does\n\n### Email Processing Flow (Per Email):\n\n1. **Plan Analysis**\n   - Agent decides: \"Which tools should I call for this email?\"\n   - Output: Analysis plan with initial risk assessment\n\n2. **Parallel Tool Calls** (3 simultaneous)\n   - **Domain Reputation**: Checks sender domain's reputation (0-100 score)\n   - **Pattern Analysis**: Scans for phishing patterns (urgency, verification, links)\n   - **Header Analysis**: Checks SPF/DKIM/DMARC (spoofing detection)\n\n3. **Multi-Factor Analysis**\n   - Synthesizes all tool results\n   - Evaluates: Domain Risk, Pattern Risk, Header Risk\n   - Checks for false positives/sophisticated attacks\n   - Calculates confidence score (0.0-1.0)\n\n4. **Confidence Gate**\n   - If confidence >= 0.8 â†’ **Accept** result\n   - If confidence < 0.8 â†’ **Escalate** to skeptical review\n\n5. **Skeptical Review** (if needed)\n   - Expert agent challenges the primary reasoning\n   - Can override classification\n   - Provides final decision\n\n6. **Result Formatting**\n   - Prepares classification for submission\n\n### Batch Processing:\n- Repeats steps 1-6 for all 20 emails\n- Recombines results\n- Submits to API\n- Returns score and flag\n\n---\n\n## ğŸ“Š Scoring Explanation\n\n| Accuracy | Score | Status | Flag |\n|----------|-------|--------|------|\n| 95-100% | 1000 | âœ… PERFECT | YES |\n| 85-94% | 900 | âœ… EXCELLENT | YES |\n| 75-84% | 800 | âš ï¸ GOOD | YES |\n| 65-74% | 700 | âš ï¸ ACCEPTABLE | YES |\n| 50-64% | 500 | âŒ PARTIAL | NO |\n| <50% | 0 | âŒ FAILED | NO |\n\n**Flag**: `FLAG{green_signal_advanced_mastered}`\n**Minimum Score for Flag**: 75% accuracy (800 points)\n\n---\n\n## ğŸ› Troubleshooting\n\n### Issue: \"Connection refused\" when fetching emails\n**Solution:**\n- Make sure backend is running on port 3000\n- Check: `curl http://localhost:3000/health`\n- If not running, start it: `python3 -m uvicorn main_advanced:app --host 0.0.0.0 --port 3000`\n\n### Issue: \"JSON parse error\" in LLM node\n**Solution:**\n- Ensure using GPT-4 or GPT-4-turbo (not GPT-3.5)\n- Check OpenAI API has available credits\n- Verify API key is correct\n- Look at error message in node output for details\n\n### Issue: Tool endpoint returns 404\n**Solution:**\n- Backend must be running\n- Check tools are receiving correct domain in request\n- Verify backend has `main_advanced.py` loaded\n\n### Issue: Stuck on one email for > 2 minutes\n**Solution:**\n- Check if LLM is responding (may be rate limited)\n- Cancel workflow (red X button)\n- Wait 30 seconds, then retry\n- Or reduce LLM complexity/use cheaper model\n\n### Issue: Low accuracy (< 75%)\n**Solution:**\n- Check \"Agent: Multi-Factor Analysis\" output\n- Look for reasoning chains\n- Verify tool results are being used correctly\n- Common issue: Agent not weighting domain reputation heavily enough\n- Check if skeptical review is improving uncertain classifications\n\n### Issue: Submission fails with length error\n**Solution:**\n- Ensure all 20 emails were processed\n- Check \"Recombine: All Results\" receives 20 items\n- Verify \"Prepare: Final Submission\" formats array correctly\n\n---\n\n## ğŸ“ Understanding the Challenge\n\n### Why This Is Hard:\n\n1. **Tool Use**: Agent must call APIs and interpret results (not just classify)\n2. **Multi-Factor**: Must synthesize evidence from 3 different perspectives\n3. **Edge Cases**:\n   - Legitimate emails with suspicious indicators\n   - Sophisticated phishing with legitimate appearance\n4. **Adaptive**: Low confidence triggers expert review\n5. **Accuracy Required**: 75%+ needed for flag\n\n### Key Insights:\n\n**Phishing Red Flags:**\n- Domain reputation < 50\n- Urgency + verification request\n- Suspicious links (http://, \\.php)\n- SPF/DKIM/DMARC failures\n\n**Legitimate Indicators:**\n- Domain reputation > 80\n- SPF/DKIM/DMARC passes\n- Normal business language\n- Known company domains\n\n**What Breaks Simple Classifiers:**\n- Real password resets use \"verify\"\n- Real urgent emails use \"URGENT\"\n- But spoofed domain = still phishing\n- Solution: Use domain reputation + auth checks\n\n---\n\n## ğŸ“ Example Execution (First Email)\n\n```\nEmail: \"URGENT: Verify Your Account\"\nFrom: noreply@security-update.com\n\n1ï¸âƒ£  Plan Analysis:\n   â†’ \"Suspicious urgency + verification. Need to check domain & auth.\"\n\n2ï¸âƒ£  Tool: Domain Reputation\n   â†’ reputation_score: 5/100 (CRITICAL)\n   â†’ established: 2024 (brand new)\n   â†’ risk_level: CRITICAL\n\n3ï¸âƒ£  Tool: Pattern Analysis\n   â†’ urgency_indicators: [\"urgent\", \"verify\"]\n   â†’ verification_requests: [\"verify account\"]\n   â†’ suspicious_links: [\"http://phish.com\"]\n   â†’ risk_score: 0.8\n\n4ï¸âƒ£  Tool: Header Analysis\n   â†’ SPF: FAIL\n   â†’ DKIM: FAIL\n   â†’ Indicators: [\"possible homograph\"]\n\n5ï¸âƒ£  Multi-Factor Analysis:\n   â†’ Domain Risk: CRITICAL (5/100)\n   â†’ Pattern Risk: CRITICAL (urgency + verification + links)\n   â†’ Header Risk: CRITICAL (SPF/DKIM fail)\n   â†’ All signals aligned: YES\n   â†’ Confidence: 0.98\n\n6ï¸âƒ£  Confidence Gate: 0.98 >= 0.8? YES\n   â†’ Accept result\n\n7ï¸âƒ£  Final Classification: PHISHING âœ“\n```\n\n---\n\n## âœ¨ Success Indicators\n\nâœ… All 21 workflow nodes execute (green checkmarks)\nâœ… Tool API calls show realistic data\nâœ… Agent reasoning includes multi-factor analysis\nâœ… ~30-40% of emails trigger \"Skeptical Review\"\nâœ… Final accuracy >= 75%\nâœ… Score >= 800\nâœ… Flag appears in results\n\n---\n\n## ğŸ“š Additional Resources\n\n- **Detailed Architecture**: `AGENTIC_ARCHITECTURE.md`\n- **Advanced Challenge Details**: `ADVANCED_CHALLENGE_GUIDE.md`\n- **Step-by-Step Instructions**: `SOLVE_STEP_BY_STEP.md`\n- **Backend Code**: `main_advanced.py`\n- **Workflow JSON**: `workflows/green-signal_advanced_agentic.json`\n\n---\n\n## ğŸ‰ Ready?\n\n1. âœ… Files verified\n2. ğŸš€ Start backend: `python3 -m uvicorn main_advanced:app --host 0.0.0.0 --port 3000`\n3. ğŸ“‚ Import workflow in n8n\n4. ğŸ”‘ Configure OpenAI credentials\n5. â–¶ï¸ Execute!\n\n**Good luck!** ğŸ€\n"