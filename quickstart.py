#!/usr/bin/env python3\n\"\"\"\nGreen Signal Advanced Challenge - Quick Start Verification\nRun this to verify all components are ready to go\n\"\"\"\n\nimport subprocess\nimport json\nimport time\nimport requests\nimport signal\nimport os\nimport sys\nfrom pathlib import Path\n\ndef check(num, desc):\n    print(f\"\\n[{num}/7] {desc}\")\n    print(\"-\" * 50)\n\ndef success(msg):\n    print(f\"‚úÖ {msg}\")\n\ndef warning(msg):\n    print(f\"‚ö†Ô∏è  {msg}\")\n\ndef error(msg):\n    print(f\"‚ùå {msg}\")\n    sys.exit(1)\n\nprint(\"\\n\" + \"=\"*50)\nprint(\"Green Signal Advanced - Quick Start Verification\")\nprint(\"=\"*50)\n\n# Check 1: Python version\ncheck(1, \"Checking Python version\")\nimport sys\nif sys.version_info >= (3, 10):\n    success(f\"Python {sys.version.split()[0]} (3.10+)\")\nelse:\n    warning(f\"Python {sys.version.split()[0]} (3.10+ recommended)\")\n\n# Check 2: Dependencies\ncheck(2, \"Checking dependencies\")\ntry:\n    import fastapi\n    import uvicorn\n    success(\"FastAPI and uvicorn installed\")\nexcept ImportError:\n    error(\"FastAPI/uvicorn not installed. Run: pip install fastapi uvicorn\")\n\n# Check 3: Email data\ncheck(3, \"Checking email data\")\nemail_file = Path(\"data/emails.json\")\nif email_file.exists():\n    with open(email_file) as f:\n        data = json.load(f)\n    success(f\"Found {len(data)} emails in data/emails.json\")\nelse:\n    warning(\"data/emails.json not found\")\n    print(\"   Run: python3 generate_messages_with_labels.py\")\n\n# Check 4: Workflow file\ncheck(4, \"Checking workflow file\")\nworkflow_file = Path(\"workflows/green-signal_advanced_agentic.json\")\nif workflow_file.exists():\n    with open(workflow_file) as f:\n        workflow = json.load(f)\n    num_nodes = len(workflow['nodes'])\n    success(f\"Found workflow with {num_nodes} nodes\")\nelse:\n    error(\"Workflow file not found\")\n\n# Check 5: Backend server files\ncheck(5, \"Checking backend files\")\nif Path(\"main_advanced.py\").exists():\n    success(\"main_advanced.py exists\")\nelse:\n    error(\"main_advanced.py not found\")\n\n# Check 6: Start and test server\ncheck(6, \"Starting backend server (test)\")\nprint(\"   Starting uvicorn on port 3000...\")\n\ntry:\n    # Start server in background\n    process = subprocess.Popen(\n        [sys.executable, \"-m\", \"uvicorn\", \"main_advanced:app\", \n         \"--host\", \"0.0.0.0\", \"--port\", \"3000\"],\n        stdout=subprocess.PIPE,\n        stderr=subprocess.PIPE\n    )\n    \n    # Wait for server to start\n    time.sleep(2)\n    \n    # Test health endpoint\n    response = requests.get(\"http://localhost:3000/health\", timeout=5)\n    if response.status_code == 200:\n        success(\"Server started and responding\")\n    else:\n        raise Exception(f\"Health check returned {response.status_code}\")\n    \n    # Test tool endpoint\n    print(\"   Testing domain-reputation tool...\")\n    response = requests.post(\n        \"http://localhost:3000/api/v2/tools/domain-reputation\",\n        json={\"domain\": \"google.com\"},\n        timeout=5\n    )\n    if response.status_code == 200:\n        data = response.json()\n        if \"reputation_score\" in data:\n            success(f\"Tool working (google.com score: {data['reputation_score']}/100)\")\n        else:\n            raise Exception(\"Unexpected response format\")\n    else:\n        raise Exception(f\"Tool returned {response.status_code}\")\n    \n    # Stop server\n    process.terminate()\n    process.wait(timeout=5)\n    \nexcept Exception as e:\n    error(f\"Server test failed: {e}\")\nexcept requests.exceptions.ConnectionError:\n    error(\"Could not connect to server on port 3000\")\n\n# Check 7: n8n availability\ncheck(7, \"Checking n8n\")\ntry:\n    response = requests.get(\"http://localhost:5678\", timeout=2)\n    success(\"n8n is running on port 5678\")\nexcept requests.exceptions.ConnectionError:\n    warning(\"n8n not running on port 5678\")\n    print(\"   Make sure n8n is started before running the workflow\")\n\nprint(\"\\n\" + \"=\"*50)\nprint(\"‚úÖ VERIFICATION COMPLETE!\")\nprint(\"=\"*50)\nprint(\"\\nüìã NEXT STEPS:\")\nprint(\"\\n1Ô∏è‚É£  Start the backend server:\")\nprint(\"   python3 -m uvicorn main_advanced:app --host 0.0.0.0 --port 3000\")\nprint(\"\\n2Ô∏è‚É£  Open n8n (http://localhost:5678)\")\nprint(\"   - Click 'New' ‚Üí 'Create blank workflow'\")\nprint(\"   - Click '...' ‚Üí 'Import from File'\")\nprint(\"   - Select: workflows/green-signal_advanced_agentic.json\")\nprint(\"\\n3Ô∏è‚É£  Configure OpenAI credentials\")\nprint(\"   - Click any orange LLM node\")\nprint(\"   - Set up OpenAI API key\")\nprint(\"\\n4Ô∏è‚É£  Execute the workflow\")\nprint(\"   - Click 'Start Advanced Agent' node\")\nprint(\"   - Click blue 'Execute' button\")\nprint(\"   - Wait for results\")\nprint(\"\\nüìñ For detailed guide, see: SOLVE_STEP_BY_STEP.md\")\nprint()\n"